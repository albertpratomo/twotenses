---
import {storyblokEditable, useStoryblokApi} from '@storyblok/astro';
import formatImage from '@/utils/formatImage';
import ProjectsGrid from '@/components/ProjectsGrid.vue';

const {blok} = Astro.props;

const api = useStoryblokApi();

const {data: {stories}} = await api.get('cdn/stories', {
    excluding_fields: 'sections',
    filter_query: {
        component: {in: 'Project'},
    },
    version: import.meta.env.DEV ? 'draft' : 'published',
});

const projects = stories.map(s => ({
    categories: s.content.categories,
    href: `/${s.full_slug}`,
    industries: s.content.industries,
    name: s.name,
    thumbnail: formatImage(s.content.thumbnail),
}));
---

<section
    {...storyblokEditable(blok)}
    class="container-fluid bg-black pb-16"
>
    <ProjectsGrid
        client:visible
        projects={projects}
    />
</section>
